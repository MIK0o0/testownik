<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .start-screen {
            text-align: center;
        }
        
        .info {
            font-size: 1.2em;
            color: #666;
            margin: 20px 0;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #4CAF50;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .btn-warning {
            background: #ff9800;
        }
        
        .btn-warning:hover {
            background: #e68900;
        }
        
        .btn-secondary {
            background: #666;
        }
        
        .btn-secondary:hover {
            background: #555;
        }
        
        .progress-container {
            margin-bottom: 30px;
        }
        
        .progress-text {
            text-align: center;
            color: #666;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        
        .question-number {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        
        .question-text {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
            line-height: 1.5;
        }
        
        .answer-btn {
            width: 100%;
            text-align: left;
            padding: 20px;
            margin: 10px 0;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s;
        }
        
        .answer-btn:hover:not(:disabled) {
            background: #e8e8e8;
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .answer-btn.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .answer-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .answer-btn:disabled {
            cursor: not-allowed;
        }
        
        .answer-checkbox {
            display: flex;
            align-items: center;
            padding: 20px;
            margin: 10px 0;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s;
        }
        
        .answer-checkbox:hover {
            background: #e8e8e8;
            border-color: #667eea;
        }
        
        .answer-checkbox.correct {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .answer-checkbox.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .answer-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        .answer-checkbox.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        .answer-checkbox.disabled input[type="checkbox"] {
            cursor: not-allowed;
        }
        
        .btn-check {
            background: #2196F3;
            margin-right: 10px;
        }
        
        .btn-check:hover {
            background: #0b7dda;
        }
        
        .question-hint {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }
        
        .result-message {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .result-message.correct {
            color: #4CAF50;
        }
        
        .result-message.wrong {
            color: #f44336;
        }
        
        .nav-buttons {
            text-align: center;
            margin-top: 30px;
        }
        
        .results-screen {
            text-align: center;
        }
        
        .score-display {
            font-size: 4em;
            font-weight: bold;
            margin: 30px 0;
            color: #667eea;
        }
        
        .percentage {
            font-size: 2em;
            color: #666;
            margin-bottom: 30px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .card {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .question-text {
                font-size: 1.2em;
            }
            
            .score-display {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Start Screen -->
            <div id="startScreen" class="start-screen">
                <h1>ðŸŽ“ Learning Quiz</h1>
                <div class="info">Total Questions: <span id="totalQuestions">0</span></div>
                <button class="btn btn-success" onclick="startQuiz()">Start Quiz</button>
            </div>
            
            <!-- Quiz Screen -->
            <div id="quizScreen" class="hidden">
                <div class="progress-container">
                    <div class="progress-text" id="progressText">Question 1 of 10</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <div class="question-number" id="questionNumber">Question #1</div>
                <div class="question-text" id="questionText"></div>
                
                <div id="answersContainer"></div>
                
                <div class="result-message hidden" id="resultMessage"></div>
                
                <div class="nav-buttons">
                    <button class="btn btn-check" id="checkBtn" onclick="checkAnswer()">Check Answer</button>
                    <button class="btn btn-success hidden" id="nextBtn" onclick="nextQuestion()">Next Question</button>
                </div>
            </div>
            
            <!-- Results Screen -->
            <div id="resultsScreen" class="results-screen hidden">
                <h1>Quiz Results</h1>
                <div class="score-display" id="scoreDisplay">0 / 0</div>
                <div class="percentage" id="percentageDisplay">0%</div>
                
                <div class="button-group">
                    <button class="btn btn-warning hidden" id="reviewBtn" onclick="reviewWrong()">Review Wrong Answers</button>
                    <button class="btn btn-success" onclick="restartQuiz()">Start New Quiz</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Parse questions from the text format
        function parseQuestions(text) {
            const lines = text.split('\n');
            const questions = [];
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i].trim();
                
                if (line.startsWith('Q|')) {
                    const parts = line.split('|');
                    if (parts.length >= 3) {
                        const qNumber = parts[1];
                        const qText = parts.slice(2).join('|');
                        
                        const answers = [];
                        i++;
                        
                        while (i < lines.length && lines[i].trim() && !lines[i].trim().startsWith('Q|')) {
                            const answerLine = lines[i].trim();
                            if (answerLine.includes('|')) {
                                const answerParts = answerLine.split('|');
                                const letter = answerParts[0];
                                let answerText = answerParts.slice(1).join('|');
                                
                                const isCorrect = answerText.includes('|CORRECT');
                                if (isCorrect) {
                                    answerText = answerText.replace('|CORRECT', '').trim();
                                }
                                
                                if (answerText) {
                                    answers.push({
                                        letter: letter,
                                        text: answerText,
                                        correct: isCorrect
                                    });
                                }
                            }
                            i++;
                        }
                        
                        if (answers.length > 0 && answers.some(a => a.correct)) {
                            const correctLetters = answers.filter(a => a.correct).map(a => a.letter);
                            questions.push({
                                number: qNumber,
                                text: qText,
                                answers: answers,
                                correctLetters: correctLetters,
                                isMultipleChoice: correctLetters.length > 1
                            });
                        }
                        continue;
                    }
                }
                i++;
            }
            
            return questions;
        }
        
        // Shuffle array
        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Global state
        let allQuestions = [];
        let currentQuestions = [];
        let currentIndex = 0;
        let correctCount = 0;
        let wrongQuestions = [];
        let answered = false;
        let selectedAnswers = new Set();
        
        // Load questions from file
        async function loadQuestionsFile() {
            try {
                const response = await fetch('pytania_z_odpowiedziami.txt');
                const text = await response.text();
                allQuestions = parseQuestions(text);
                document.getElementById('totalQuestions').textContent = allQuestions.length;
            } catch (error) {
                console.error('Error loading questions:', error);
                alert('Error loading questions file. Make sure pytania_z_odpowiedziami.txt is in the same directory.');
            }
        }
        
        function startQuiz() {
            currentQuestions = shuffle(allQuestions);
            currentIndex = 0;
            correctCount = 0;
            wrongQuestions = [];
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            loadQuestion();
        }
        
        function loadQuestion() {
            if (currentIndex >= currentQuestions.length) {
                showResults();
                return;
            }
            
            answered = false;
            selectedAnswers = new Set();
            const question = currentQuestions[currentIndex];
            
            // Update progress
            const progress = (currentIndex + 1) / currentQuestions.length * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `Question ${currentIndex + 1} of ${currentQuestions.length}`;
            
            // Update question
            document.getElementById('questionNumber').textContent = `Question #${question.number}`;
            document.getElementById('questionText').textContent = question.text;
            
            // Shuffle and create checkboxes for all questions
            const shuffledAnswers = shuffle(question.answers);
            const container = document.getElementById('answersContainer');
            container.innerHTML = '';
            
            shuffledAnswers.forEach(answer => {
                const div = document.createElement('div');
                div.className = 'answer-checkbox';
                div.dataset.letter = answer.letter;
                div.onclick = function(e) {
                    if (!answered && e.target.type !== 'checkbox') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                        onCheckboxChange();
                    }
                };
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `answer-${answer.letter}`;
                checkbox.onchange = onCheckboxChange;
                
                const label = document.createElement('label');
                label.setAttribute('for', `answer-${answer.letter}`);
                label.textContent = `${answer.letter}. ${answer.text}`;
                label.style.cursor = 'pointer';
                label.style.flex = '1';
                
                div.appendChild(checkbox);
                div.appendChild(label);
                container.appendChild(div);
            });
            
            // Show check button and disable it initially
            document.getElementById('checkBtn').classList.remove('hidden');
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('resultMessage').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
        }
        
        function onCheckboxChange() {
            if (answered) return;
            const checkboxes = document.querySelectorAll('#answersContainer input[type="checkbox"]');
            const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
            document.getElementById('checkBtn').disabled = !anyChecked;
        }
        
        function checkAnswer() {
            if (answered) return;
            answered = true;
            
            // Collect selected answers from checkboxes
            selectedAnswers = new Set();
            document.querySelectorAll('#answersContainer input[type="checkbox"]:checked').forEach(cb => {
                const div = cb.closest('.answer-checkbox');
                selectedAnswers.add(div.dataset.letter);
            });
            
            const question = currentQuestions[currentIndex];
            const correctSet = new Set(question.correctLetters);
            const isCorrect = selectedAnswers.size === correctSet.size && 
                             [...selectedAnswers].every(letter => correctSet.has(letter));
            
            // Update UI - highlight correct and wrong answers
            const checkboxDivs = document.querySelectorAll('.answer-checkbox');
            checkboxDivs.forEach(div => {
                div.classList.add('disabled');
                const checkbox = div.querySelector('input[type="checkbox"]');
                checkbox.disabled = true;
                
                const letter = div.dataset.letter;
                if (correctSet.has(letter)) {
                    div.classList.add('correct');
                } else if (selectedAnswers.has(letter)) {
                    div.classList.add('wrong');
                }
            });
            
            // Hide check button
            document.getElementById('checkBtn').classList.add('hidden');
            
            // Show result message
            const resultMsg = document.getElementById('resultMessage');
            resultMsg.classList.remove('hidden');
            if (isCorrect) {
                resultMsg.textContent = 'âœ“ Correct!';
                resultMsg.className = 'result-message correct';
                correctCount++;
            } else {
                const correctText = question.correctLetters.join(', ');
                resultMsg.textContent = `âœ— Wrong! Correct answer${question.correctLetters.length > 1 ? 's' : ''}: ${correctText}`;
                resultMsg.className = 'result-message wrong';
                wrongQuestions.push(question);
            }
            
            document.getElementById('nextBtn').classList.remove('hidden');
        }
        
        function nextQuestion() {
            currentIndex++;
            loadQuestion();
        }
        
        function showResults() {
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const total = currentQuestions.length;
            const percentage = (correctCount / total * 100);
            
            document.getElementById('scoreDisplay').textContent = `${correctCount} / ${total}`;
            document.getElementById('percentageDisplay').textContent = `${percentage.toFixed(1)}%`;
            
            const reviewBtn = document.getElementById('reviewBtn');
            if (wrongQuestions.length > 0) {
                reviewBtn.classList.remove('hidden');
                reviewBtn.textContent = `Review Wrong Answers (${wrongQuestions.length})`;
            } else {
                reviewBtn.classList.add('hidden');
            }
        }
        
        function reviewWrong() {
            currentQuestions = shuffle(wrongQuestions);
            currentIndex = 0;
            correctCount = 0;
            wrongQuestions = [];
            
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            loadQuestion();
        }
        
        function restartQuiz() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }
        
        // Initialize on page load
        loadQuestionsFile();
    </script>
</body>
</html>

